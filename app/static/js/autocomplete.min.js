let searchInput,currentFocus,originalSearch,autocompleteResults;
const handleUserInput=()=>{let a=new XMLHttpRequest;a.open("POST","autocomplete");a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.onload=function(){if(4!==a.readyState||200===a.status)autocompleteResults=JSON.parse(a.responseText)[1],updateAutocompleteList()};a.send("q="+searchInput.value)},closeAllLists=a=>{let b=document.getElementsByClassName("autocomplete-items");for(let c=0;c<b.length;c++)a!==b[c]&&a!==searchInput&&b[c].parentNode.removeChild(b[c])},removeActive=a=>{for(let b=
0;b<a.length;b++)a[b].classList.remove("autocomplete-active")},addActive=a=>{if(!a||!a[currentFocus])if(currentFocus>=a.length)currentFocus=0;else{0>currentFocus&&(currentFocus=-1,searchInput.value=originalSearch,removeActive(a));return}removeActive(a);a[currentFocus].classList.add("autocomplete-active");a=a[currentFocus].textContent;0<a.indexOf("(")?searchInput.value=a.substring(0,a.indexOf("(")):searchInput.value=a;searchInput.focus()},autocompleteInput=a=>{let b=document.getElementById(this.id+
"-autocomplete-list");b&&=b.getElementsByTagName("div");40===a.keyCode?(a.preventDefault(),currentFocus++,addActive(b)):38===a.keyCode?(a.preventDefault(),currentFocus--,addActive(b)):13===a.keyCode?(a.preventDefault(),-1<currentFocus&&b&&b[currentFocus].click()):originalSearch=searchInput.value},updateAutocompleteList=()=>{let a,b,c,d=originalSearch;closeAllLists();if(!d||!autocompleteResults)return!1;currentFocus=-1;a=document.createElement("div");a.setAttribute("id",this.id+"-autocomplete-list");
a.setAttribute("class","autocomplete-items");searchInput.parentNode.appendChild(a);for(c=0;c<autocompleteResults.length;c++)autocompleteResults[c].substr(0,d.length).toUpperCase()===d.toUpperCase()&&(b=document.createElement("div"),b.innerHTML="<strong>"+autocompleteResults[c].substr(0,d.length)+"</strong>",b.innerHTML+=autocompleteResults[c].substr(d.length),b.innerHTML+='<input type="hidden" value="'+autocompleteResults[c]+'">',b.addEventListener("click",function(){searchInput.value=this.getElementsByTagName("input")[0].value;
closeAllLists();document.getElementById("search-form").submit()}),a.appendChild(b))};document.addEventListener("DOMContentLoaded",function(){searchInput=document.getElementById("search-bar");searchInput.addEventListener("keydown",a=>autocompleteInput(a));document.addEventListener("click",function(a){closeAllLists(a.target)})});
